<!DOCTYPE html>
<html>
  <head>
    <title>Google Sheets API Quickstart</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <p>LET'S GET IT</p>

    <button id="authorize_button" style="display: none;">Authorize</button>
    <button id="signout_button" style="display: none;">Sign Out</button>
    <button id="clear_button">Clear</button>

    <pre id="content" style="white-space: pre-wrap;">
      <pre id="child_content" style="white-space: pre-wrap;"></pre>
    </pre>

    <script type="text/javascript">
      
      const CLIENT_ID = '577068218731-hlmpjf8t01pmu8dkr260un2j9i8loj9i.apps.googleusercontent.com';
      const API_KEY = 'AIzaSyBf7v70QcuU-Z7QRThnChyOsAqgQzDuYTI';

     
      const DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];

      const SCOPES = "https://www.googleapis.com/auth/spreadsheets";

      const authorizeButton = document.getElementById('authorize_button');
      const signoutButton = document.getElementById('signout_button');
      const clearButton = document.getElementById('clear_button');
    
      clearButton.addEventListener("click", function (){
        clearData();
        removeText();
        putText("No data now");
      });

      function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      function initClient() {
        gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: DISCOVERY_DOCS,
          scope: SCOPES
        }).then(function () {
          
          gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

          updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
          authorizeButton.onclick = handleAuthClick;
          signoutButton.onclick = handleSignoutClick;
          clearButton.onclick = clearData;
        }, function(error) {
          putText(JSON.stringify(error, null, 2));
        });
      }

      function updateSigninStatus(isSignedIn) {
        if (isSignedIn) {
          authorizeButton.style.display = 'none';
          clearButton.style.display = 'display';
          signoutButton.style.display = 'block';
          //addNewCoord();
          listCoords();
        } else {
          authorizeButton.style.display = 'block';
          clearButton.style.display = 'block';
          signoutButton.style.display = 'none';
        }
      }

      function handleAuthClick(event) {
        gapi.auth2.getAuthInstance().signIn();
      }

      function handleSignoutClick(event) {
        gapi.auth2.getAuthInstance().signOut();
      }

      function clearData() {
        const params = {
          spreadsheetId: '1jl_p1MpWZ0WcTndmqewjWkyoLA1rG2NO5pszqB56i74',
          range: 'A2:C21',  
        };

        const clearValuesRequestBody = {
        };

        const request = gapi.client.sheets.spreadsheets.values.clear(params, clearValuesRequestBody);
        request.then(function(response) {
          console.log(response.result);
        }, function(reason) {
          console.error('error: ' + reason.result.error.message);
        });
      }

      function putText(message) {
        const pre = document.getElementById('child_content');
        const textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent)
      }

      function removeText(){
        const text = document.getElementById('content');
        const childText = document.getElementById('child_content')
        text.removeChild(childText);
      }

      function listCoords() {
        gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: '1jl_p1MpWZ0WcTndmqewjWkyoLA1rG2NO5pszqB56i74',
          range: 'A2:C21',
        }).then(function(response) {
          console.log(response);
          const range = response.result;
          if (range.values.length > 0) {
            putText('X, Y, R, Hit, Script Execution, Date:');
            for (i = 0; i < range.values.length; i++) {
              const row = range.values[i];            
              putText(row[0] + ', ' + row[1] + ', ' + row[2] + ', ' + row[3] + ', ' + row[4] + ', ' + row[5]);
            }
          } else {
            putText('No data found.');
          }
        }, function(response) {
          putText('Error: ' + response.result.error.message);
        });
      }

      function addNewCoord() {
      const params = {
        spreadsheetId: '1jl_p1MpWZ0WcTndmqewjWkyoLA1rG2NO5pszqB56i74',
        range: 'A8:C8', 
        valueInputOption: 'USER_ENTERED',  
      };

      const valueRangeBody = {
        values: [
          [2, 2, 2]
        ],
      };

      const request = gapi.client.sheets.spreadsheets.values.update(params, valueRangeBody);
      request.then(function(response) {
        console.log(response.result);
      }, function(reason) {
        console.error('error: ' + reason.result.error.message);
      });
    }

    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
  </body>
</html>